# 分布式应用的需求

正如在[《分布式系统》](https://ng-tech.icu/DistributedSystem-Series)中的讨论，现在当我们构建服务端应用程序时，随着业务逻辑复杂度以及协作者的增加，我们不可避免地会将其变为分布式应用。良好的分布式应用程序应该是无状态的、可扩展的、可配置的、独立发布的、容器化的、可自动化的，有时甚至是事件驱动的和 Serverless。创建之后，它们应该很容易进行升级，并且可以承受长期的维护。基于这些目标，借鉴[《多运行时微服务架构实践》](https://mp.weixin.qq.com/s/Sqpz4KD6Gyb7GDd0WVT8dg)一文中的描述，我们从以下几个维度去概述分布式应用程序的需求：网络（Networking），生命周期管理（Lifecycle），状态管理（State）以及高可用（High Availability）。

# 网络（Networking）

分布式应用自然是被网络分隔的，其首要问题就是如何发现服务以及服务对应的实例；一般来说服务注册与发现机制是常用的思路，找到服务后，当前的请求应该选择发往服务的哪一个实例呢？一般来说，如果同一个服务的实例都是完全对等的（无状态），那么按负载均衡策略来处理就足够（轮询、权重、hash、一致性 hash，fair 等各种策略的适用场景）；如果同一个服务的实例不是对等的（有状态），那么需要通过路由服务（元数据服务等）先确定当前要访问的请求数据做哪一个实例上，然后再进行访问。

# 生命周期管理（Lifecycle）

# 状态管理（State）

# 高可用（High Availability）

> 参阅 [《HA Series》](https://github.com/wx-chevalier/HA-Series) 以获取更多讨论。

对于一个分布式系统，如果我们不能很清楚地了解内部的状态，那么高可用是没有办法完全保障的，所以对分布式系统的监控（比如接口的时延和可用性等信息），分布式追踪 Trace，模拟故障的混沌工程，以及相关的告警等机制是一定要完善的；

系统雪崩是指故障的由于正反馈循序导致不断扩大规则的故障。一次雪崩通常是由于整个系统中一个很小的部分出现故障于引发，进而导致系统其它部分也出现故障。比如系统中某一个服务的一个实例出现故障，导致负载均衡将该实例摘除而引起其它实例负载升高，最终导致该服务的所有实例像多米诺骨牌一样一个一个全部出现故障。

避免雪崩总体的策略比较简单，只要是两个思路，一个是快速失败和降级机制（熔断、降级、限流等），通过快速减少系统负载来避免雪崩的发生；另一个为弹性扩容机制，通过快速增加系统的服务能力来避免雪崩的发生。这个根据不同的场景可以做不同的选择，或者两个策略都使用。一般来说，快速失败会导致部分的请求失败，如果分布式系统内部对一致性要求很高的话，快速失败会带来系统数据不一致的问题，弹性扩容会是一个比较好的选择，但是弹性扩容的实现成本和响应时间比快速失败要大得多。

# TBD

- 多运行时微服务架构实践 https://mp.weixin.qq.com/s/Sqpz4KD6Gyb7GDd0WVT8dg
